PRAGMA foreign_keys = ON;

-- Очистка таблиц (в правильном порядке зависимостей)
DELETE FROM TaxObligation;
DELETE FROM Payout;
DELETE FROM TransactionTable;
DELETE FROM Instrument;
DELETE FROM InvestmentAccount;
DELETE FROM Client;

-- Заполнение Client (10 записей)
INSERT INTO Client (tax_status, full_name, email, phone, registration_date) VALUES
    ('Resident', 'Иванов Иван Иванович', 'ivanov@example.com', '+79990000001', '2024-01-10'),
    ('NonResident', 'Петров Пётр Петрович', NULL, '+79990000002', '2024-02-15'),
    ('Resident', 'Сидорова Анна Сергеевна', 'anna@example.com', NULL, '2024-03-20'),
    ('Resident', 'Козлов Дмитрий Алексеевич', 'dmitry@example.com', '+79990000003', '2024-04-05'),
    ('NonResident', 'Смирнова Елена Викторовна', NULL, '+79990000004', '2024-05-12'),
    ('Resident', 'Михайлов Сергей Павлович', 'sergey@example.com', '+79990000005', '2024-06-18'),
    ('Resident', 'Фёдорова Ольга Николаевна', NULL, NULL, '2024-07-22'),
    ('NonResident', 'Васильев Андрей Игоревич', 'andrey@example.com', '+79990000006', '2024-08-30'),
    ('Resident', 'Кузнецова Мария Александровна', 'maria@example.com', '+79990000007', '2024-09-10'),
    ('Resident', 'Лебедев Виктор Олегович', NULL, '+79990000008', '2024-10-25');

-- Заполнение InvestmentAccount (10 записей)
INSERT INTO InvestmentAccount (client_id, account_type, open_date) VALUES
    (1, 'Brokerage', '2024-01-15'),
    (1, 'IIS', '2024-02-01'),
    (2, 'Brokerage', '2024-02-20'),
    (3, 'Trust', '2024-03-25'),
    (4, 'Brokerage', '2024-04-10'),
    (5, 'IIS', '2024-05-15'),
    (6, 'Brokerage', '2024-06-20'),
    (7, 'Trust', '2024-07-25'),
    (8, 'Brokerage', '2024-09-01'),
    (9, 'IIS', '2024-10-01');

-- Заполнение Instrument (10 записей)
INSERT INTO Instrument (name, category, expected_payout_per_unit, current_price, expected_payout_date) VALUES
    ('Сбербанк', 'Stock', 1.50, 300.00, '2025-04-01'),
    ('Газпром', 'Stock', 2.00, 150.00, '2025-06-15'),
    ('Лукойл', 'Stock', 3.00, 7000.00, '2025-07-10'),
    ('Роснефть', 'Stock', NULL, 500.00, NULL),
    ('МТС', 'Stock', 1.20, 250.00, '2025-05-20'),
    ('Облигация ОФЗ', 'Bond', 50.00, 1000.00, '2025-03-01'),
    ('Облигация ВТБ', 'Bond', 40.00, 950.00, '2025-08-01'),
    ('ETF Финекс', 'ETF', NULL, 100.00, NULL),
    ('ETF Сбербанк', 'ETF', 0.50, 120.00, '2025-09-01'),
    ('Норникель', 'Stock', 10.00, 15000.00, '2025-04-15');

-- Заполнение TransactionTable (10 записей)
INSERT INTO TransactionTable (account_id, instrument_id, type, quantity, price_per_unit, commission, transaction_date) VALUES
    (1, 1, 'Buy', 100.00, 300.00, 30.00, '2024-02-01 10:00:00'),
    (2, 2, 'Buy', 200.00, 150.00, 15.00, '2024-03-01 11:00:00'),
    (3, 3, 'Buy', 10.00, 7000.00, 70.00, '2024-04-01 12:00:00'),
    (4, 4, 'Sell', 50.00, 500.00, 25.00, '2024-05-01 13:00:00'),
    (5, 5, 'Buy', 150.00, 250.00, 37.50, '2024-06-01 14:00:00'),
    (6, 6, 'Buy', 20.00, 1000.00, 20.00, '2024-07-01 15:00:00'),
    (7, 7, 'Buy', 30.00, 950.00, 28.50, '2024-08-01 16:00:00'),
    (8, 8, 'Buy', 500.00, 100.00, 50.00, '2024-09-01 17:00:00'),
    (9, 9, 'Buy', 400.00, 120.00, 48.00, '2024-10-01 18:00:00'),
    (10, 10, 'Buy', 5.00, 15000.00, 75.00, '2024-11-01 19:00:00');

-- Заполнение Payout (15 записей)
INSERT INTO Payout (transaction_id, type, amount, payout_date) VALUES
    (1, 'Dividends', 150.00, '2024-04-01 09:00:00'), -- 100 акций * 1.5
    (2, 'Dividends', 400.00, '2024-06-15 09:00:00'), -- 200 акций * 2.0
    (3, 'Dividends', 30.00, '2024-07-10 09:00:00'),  -- 10 акций * 3.0
    (4, 'Profit', 2000.00, '2024-05-01 09:00:00'),    -- Прибыль от продажи
    (5, 'Dividends', 180.00, '2024-05-20 09:00:00'),   -- 150 акций * 1.2
    (6, 'Dividends', 1000.00, '2024-03-01 09:00:00'),  -- 20 облигаций * 50
    (7, 'Dividends', 1200.00, '2024-08-01 09:00:00'),  -- 30 облигаций * 40
    (8, 'Dividends', 0.00, '2024-09-01 09:00:00'),     -- ETF без дивидендов
    (9, 'Dividends', 200.00, '2024-09-01 09:00:00'),   -- 400 ETF * 0.5
    (10, 'Dividends', 50.00, '2024-04-15 09:00:00'),   -- 5 акций * 10
    (1, 'Profit', 500.00, '2024-05-15 09:00:00'),      -- Доп. прибыль
    (2, 'Dividends', 400.00, '2024-07-15 09:00:00'),   -- Ещё дивиденды
    (3, 'Profit', 1000.00, '2024-08-15 09:00:00'),     -- Прибыль
    (5, 'Dividends', 180.00, '2024-06-20 09:00:00'),   -- Ещё дивиденды
    (6, 'Dividends', 1000.00, '2024-09-01 09:00:00');  -- Ещё купоны

-- Заполнение TaxObligation (15 записей)
INSERT INTO TaxObligation (payout_id, amount, due_date, calculation_basis) VALUES
    (1, 19.50, '2024-04-30', 'НДФЛ 13% на дивиденды'),   -- 150 * 0.13
    (2, 120.00, '2024-06-30', 'НДФЛ 30% на дивиденды'),   -- 400 * 0.3 (NonResident)
    (3, 3.90, '2024-07-31', 'НДФЛ 13% на дивиденды'),     -- 30 * 0.13
    (4, 300.00, '2024-05-31', 'НДФЛ 15% на прибыль'),     -- 2000 * 0.15
    (5, 23.40, '2024-05-31', 'НДФЛ 13% на дивиденды'),    -- 180 * 0.13
    (6, 130.00, '2024-03-31', 'НДФЛ 13% на купоны'),      -- 1000 * 0.13
    (7, 360.00, '2024-08-31', 'НДФЛ 30% на купоны'),      -- 1200 * 0.3
    (8, 0.00, '2024-09-30', 'НДФЛ 13% на дивиденды'),     -- 0 * 0.13
    (9, 26.00, '2024-09-30', 'НДФЛ 13% на дивиденды'),    -- 200 * 0.13
    (10, 15.00, '2024-04-30', 'НДФЛ 30% на дивиденды'),   -- 50 * 0.3
    (11, 65.00, '2024-05-31', 'НДФЛ 13% на прибыль'),     -- 500 * 0.13
    (12, 120.00, '2024-07-31', 'НДФЛ 30% на дивиденды'),  -- 400 * 0.3
    (13, 130.00, '2024-08-31', 'НДФЛ 13% на прибыль'),    -- 1000 * 0.13
    (14, 23.40, '2024-06-30', 'НДФЛ 13% на дивиденды'),   -- 180 * 0.13
    (15, 130.00, '2024-09-30', 'НДФЛ 13% на купоны');     -- 1000 * 0.13